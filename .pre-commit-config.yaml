# =============================================================================
# Pre-commit hooks for ChatGPT Codex Development Environment
# Simplified configuration using direct tool calls for reliability
# =============================================================================

repos:
  # Built-in hooks for basic file hygiene
  - repo: local
    hooks:
      # File formatting and cleanup
      - id: trailing-whitespace
        name: Trim Trailing Whitespace
        entry: python3 tools/pre_commit_helpers.py trailing-whitespace
        language: system
        types: [text]
        stages: [pre-commit, manual]

      - id: end-of-file-fixer
        name: Fix End of Files
        entry: python3 tools/pre_commit_helpers.py end-of-file
        language: system
        types: [text]
        stages: [pre-commit, manual]

      - id: check-yaml
        name: Check YAML
        entry: python3 tools/pre_commit_helpers.py check-yaml
        language: system
        files: \.(yaml|yml)$
        stages: [pre-commit, manual]

      - id: yamllint
        name: yamllint
        entry: yamllint
        language: system
        files: .github/workflows/.*\.yml$
        stages: [pre-commit, manual]

      - id: check-json
        name: Check JSON
        entry: python3 tools/pre_commit_helpers.py check-json
        language: system
        files: \.json$
        stages: [pre-commit, manual]

      - id: check-merge-conflict
        name: Check for merge conflicts
        entry: python3 tools/pre_commit_helpers.py check-merge-conflict
        language: system
        types: [text]
        stages: [pre-commit, manual]

      # Type checking
      - id: mypy
        name: MyPy Type Checking
        entry: mypy
        language: python
        types: [python]
        files: ^src/
        # Configuration is provided via pyproject.toml
        additional_dependencies: [
          "mypy>=1.15.0",
          "pydantic[mypy]>=2.7.4",
          "rich>=13.7.1"
        ]
        stages: [pre-commit, manual]

      # Fast syntax check for all Python files
      - id: python-check-ast
        name: Check Python AST
        entry: python3
        args: ['-m', 'py_compile']
        language: system
        types: [python]
        stages: [pre-commit, manual]

      # Security check (basic patterns)
      - id: security-check
        name: Basic Security Check
        entry: python3 tools/pre_commit_helpers.py security-check
        language: system
        types: [python]
        stages: [pre-commit, manual]

      # ice-t smoke tests
      - id: ice-t-smoke-tests
        name: ice-t Smoke Tests
        entry: python3
        args: ['scripts/adaptive_test_runner.py', 'run', '--smoke']
        language: system
        pass_filenames: false
        stages: [manual]

      # ice-t unit tests
      - id: ice-t-unit-tests
        name: ice-t Unit Tests
        entry: python3
        args: ['scripts/adaptive_test_runner.py', 'run', '--level', 'full']
        language: system
        pass_filenames: false
        stages: [manual]

      # ice-t integration tests
      - id: ice-t-integration-tests
        name: ice-t Integration Tests
        entry: python3
        args: ['scripts/adaptive_test_runner.py', 'run', '--level', 'integration']
        language: system
        pass_filenames: false
        stages: [manual]

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.11.11
    hooks:
      - id: ruff
        args: [--fix]
      - id: ruff-format



# =============================================================================
# Pre-commit configuration
# =============================================================================
default_stages: [pre-commit]
fail_fast: false  # Continue running hooks even if one fails
minimum_pre_commit_version: "4.0"

# Exclude patterns
exclude: |
  (?x)^(
    .*\.min\.js|
    .*\.min\.css|
    .*/migrations/.*|
    .*/node_modules/.*|
    .*/venv/.*|
    .*/\.venv/.*|
    \.venv/.*|
    venv/.*|
    build/.*|
    dist/.*|
    logs/.*|
    \.coverage.*|
    htmlcov/.*
  )$
