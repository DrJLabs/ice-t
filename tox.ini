[tox]
requires = tox>=4
envlist = lint, type, security, tests, build

[testenv]
setenv =
    PYTHONUNBUFFERED = 1
deps =
    -r requirements.txt
    -r dev-requirements.txt
commands =
    python --version

[testenv:lint]
description = Run pre-commit quality checks
skip_install = true
deps = pre-commit
commands = pre-commit run --all-files --show-diff-on-failure

[testenv:type]
description = Run static type checks
skip_install = true
deps = mypy
commands = mypy --explicit-package-bases --namespace-packages --strict-optional --show-error-codes src/ice_t

[testenv:security]
description = Run Bandit and Safety
skip_install = true
deps =
    bandit
    safety
commands =
    bandit -r src/
    safety check --full-report

[testenv:tests]
description = Run the full test suite via the adaptive runner
commands = python scripts/adaptive_test_runner.py run --level full

[testenv:build]
description = Build the project
skip_install = true
deps = build
commands = python -m build
